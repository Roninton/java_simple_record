## 1、Redis 是什么？
Redis（Remote Dictionary Server） 是一个开源的、基于内存的 **键值对（Key-Value）存储系统**，常被用作：
1. 高性能缓存（如商品详情页、用户会话）
2. 分布式锁（如秒杀防超卖）
3. 计数器（如阅读量、点赞数）
4. 消息队列（轻量级）
5. 排行榜（如游戏积分）

## 2、Redis如何保证原子性
1. Redis 主线程串行处理命令，单个命令不可分割。
- 例如 INCR key：读 → 加1 → 写，整个过程不会被其他命令打断。

## 3、Redis持久化方式
Redis 提供两种持久化方式，通常 混合使用：
| 方式 | 原理 | 优点 | 缺点 | 适用场景 |
|------|------|------|------|--------|
| RDB快照(Redis Database) | 定期 fork 子进程生成内存快照（dump.rdb） | 文件小、恢复快 | 可能丢失最后一次快照后的数据 | 备份、主从全量同步 |
| 日志(Append-Only File, AOF) | 记录所有写命令到 appendonly.aof 文件 | 数据更安全（最多丢1秒） | 文件大、恢复慢 | 金融、核心业务 |

### 刷盘策略（AOF）：
- `appendfsync always`：每条命令刷盘（安全但慢）
- `appendfsync everysec`：默认推荐（平衡安全与性能）
- `appendfsync no`：由 OS 决定（快但危险）

### 混合持久化（Redis 4.0+）：
设置： `aof-use-rdb-preamble yes`

每次触发 AOF 重写（BGREWRITEAOF）时：
1. 子进程会先将当前内存中的全量数据以 RDB 格式写入新 AOF 文件的开头；
2. 同时，主进程会把重写期间新到达的写命令缓存到 AOF 重写缓冲区；
3. 待重写完成后，这些增量命令以 AOF 格式追加到文件末尾。
最终生成的 AOF 文件 = RDB 快照（前半段） + AOF 增量日志（后半段）。”
#### “Redis 宕机了数据会丢吗？” 
回答需结合 RDB/AOF 配置说明最大可能丢失时间。

## 4、Redis事务机制
Redis 事务 ≠ MySQL 事务！

- [√] 保证命令顺序执行（不被其他客户端打断）
- [x] 不支持回滚（Rollback）：即使某条命令失败，后续仍会执行
- [x] 不满足 ACID（只满足 Consistency + Isolation 的弱形式）

## 5、 Redis的高可用架构
1. 主从复制：主写从读，提升读性能
2. 哨兵（Sentinel）：自动故障转移（主挂了，选新主）
3. Cluster 集群：分片存储（16384 个 slot），支持水平扩展

## 6、 Redis的缓存问题
1. 缓存穿透：查不存在的数据 → 布隆过滤器 / 缓存空值
2. 缓存击穿：热点 key 过期瞬间大量请求 → 互斥锁 / 逻辑过期
3. 缓存雪崩：大量 key 同时过期 → 随机 TTL + 高可用架构